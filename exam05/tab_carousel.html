//1.exam view안에 carousel object 생성 합니다.
//2.this.opts는 파라미터 값이 있으면 파라미터 값으로, 없으면 default 값으로 설정 합니다.
//3. this.init은 exam.View.carousel.prototype 안에 있는 init 을 호출 합니다. 
//4. slideBox 변수에 new exam.View.slideBox() 생성자 함수 호출 합니다.  
(function (win, $) {
    'use strict';
    var exam = exam || {};
    exam.View = exam.View || {};

    exam.View.carousel = function (container, opts) {
        var defParams = {
                            wrap : $(container),
                            slider: '.swiper-slide'
                        };
        this.opts = $.extend({}, defParams, opts);
        this.init();
        
    };

    exam.View.carousel.prototype = {
        init : function () {
            this.curIndex = 0;
            this.$index = 0;
            this.$tabCont = $('.cast_cont>div');
            this.curNav = $('.cast_num').find('.current');
            this._setElement();
            this._bindEvent();
            this._initFunc();
        },
        _setElement : function () {
            this.wrap = this.opts.wrap;
            this.slider = this.wrap.find(this.opts.slider);

            this.$tabLi = $('.cast_tab > ul > li');
            this.$tabLilength = $('.cast_tab > ul > li').length;
            this.$tabNum = $('.cast_num .total');
            this.$btnPrev = $('.cast_setting').find('.cast_btn > button').eq(0);
            this.$btnNext = $('.cast_setting').find('.cast_btn > button').eq(1); 
        },
        _bindEvent:function(){
            var oself = this;
            this.$tabLi.on('click', function(e){
                e.preventDefault();
                oself.curIndex = $(this).index();
                //lnb 
                $(this).addClass('active');
                $(this).siblings().removeClass('active');
                oself.showCont();
            });            
            this.$btnPrev.on('click', $.proxy(this.showPrev, this))  
            this.$btnNext.on('click', $.proxy(this.showNext, this))   
        },

        _initFunc : function() {
            this.$tabNum.text(this.$tabLilength);
        },

        showCont : function() {    
            
            //탭 내용                         
            this.$tabCont.hide();
            this.$tabCont.eq(this.curIndex).fadeIn();
            //네비게이션 값 설정
            this.curNav.text(this.curIndex+1) ;
        },
        showPrev : function(){
             this.curIndex--;  
             if(this.curIndex<0){
                this.curIndex = this.$tabLilength;
             }  
            $('.cast_tab li').eq(this.curIndex).trigger('click');  
        }, 
        showNext : function(){
            this.curIndex++;    
            $('.cast_tab li').eq(this.curIndex).trigger('click');
            if (this.curIndex > this.$tabLilength ){
               this.curIndex = 0;
            }
            $('.cast_tab li').eq(this.curIndex).trigger('click');
        },
    };

    


    exam.View.slideBox = function (container, opts) {
        var defParams = {
                            wrap : $(container),
                            slider: '.swiper-slide'
                        };
        this.opts = $.extend({}, defParams, opts);
        this.init();
        
    };

    exam.View.slideBox.prototype = {
        orgIndex : 0,
        curIndex : 0,
        init:function(){
            this._setElement();
            this._bindEvent();      
            this.$slideCont.hide();
            this.$slideCont.eq(this.curIndex).show();
        },
        _setElement:function(){
            this.wrap = this.opts.wrap;
            this.slider = this.wrap.find(this.opts.slider);

            this.$btnPrev = $('.slide_setting').find('.slide_btn > button').eq(0);
            this.$btnNext = $('.slide_setting').find('.slide_btn > button').eq(1);        
            this.$btnNav = $('.slide_tab').find('ul > li'); 
            this.$slideCont = $('.slide_cont').find('.slide_article');
        },
        _bindEvent:function(){
            var oSelf = this;
            this.$btnNav.on('click', function(e){
                e.preventDefault();
                oSelf.orgIndex = oSelf.curIndex;
                oSelf.curIndex = $(this).index(); 
                oSelf.showNav();
            });  
            this.$btnPrev.on('click', $.proxy(this.showPrev, this)); 
            this.$btnNext.on('click', $.proxy(this.showNext, this));              
        },
         showPrev : function(){
            this.orgIndex = this.curIndex;
            this.curIndex --;
            if(this.curIndex < 0){
                this.curIndex = 7;
            };
            //컨텐츠 호출
            this.showThis('prev');            
        }, 
        showNext : function(){
            this.orgIndex = this.curIndex;
            this.curIndex ++;
            if(this.curIndex > 7){
                this.curIndex = 0;
            };
            this.showThis();
        },
        showNav:function(e){

            var type = '';
            if(this.orgIndex < this.curIndex){
                type = 'next';
            }else{
                type = 'prev';
            }
            
            this.showThis(type);
        },
        showThis : function (type){    
            if(this.curIndex  == this.orgIndex){
                return;
            }
            
            //네비게이션 
            if(type === 'prev'){
                //이전 슬라이드 내용
                this.$slideCont.eq(this.curIndex).css('left', '-100%');
                this.$slideCont.eq(this.curIndex).show();
                this.$slideCont.eq(this.orgIndex).stop().animate({
                    left: '100%'
                },function(){
                    $(this).hide();
                    $(this).css('left','');
                });
                this.$slideCont.eq(this.curIndex).stop().animate({
                    left:  0
                });
            }else{
                //다음 슬라이드 
                this.$slideCont.eq(this.curIndex).css('left', '100%');
                this.$slideCont.eq(this.curIndex).show();
                this.$slideCont.eq(this.orgIndex).stop().animate({
                    left: '-100%'
                },function(){
                    $(this).hide();
                    $(this).css('left','');
                });
                this.$slideCont.eq(this.curIndex).stop().animate({
                    left:  0
                });
            }    
            this.$btnNav.eq(this.curIndex).addClass('active');
            this.$btnNav.eq(this.curIndex).siblings().removeClass();           
            
        }
    }

     var slideBox = new exam.View.slideBox('.cast_cont', {
        slider : '.cast_article'
    });

     var castBox = new exam.View.carousel('.slide_cont', {
        slider : '.slide_article'
    });

})(window, window.jQuery);
